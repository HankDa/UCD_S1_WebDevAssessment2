<!DOCTYPE html>
<html>
    
<head>
<!-- The CSS styles defined here are not strictly necessary, but do make it easier to read the table -->    
<style>

table, th, td {
    border: 1px solid grey;
    border-collapse: collapse;
    padding: 5px;
}

th {
    background-color: #4CAF50;
    color: white;
}
      
table tr:nth-child(odd) {
    background-color: #f1f1f1;
}
table tr:nth-child(even) {
    background-color: #ffffff;
}
   
</style>    
</head>      
    
<body>

<div id="id01">...</div>
<div id="id02">...</div>

   
<script>

var xmlhttp = new XMLHttpRequest();
var url = "scheduling.json";
// var parsedObj = new Object();
var dir_date = {};
var dir_date_time ={};

xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        
        //Parse the JSON data to a JavaScript variable. 
        
        parsedObj = JSON.parse(xmlhttp.responseText);    // Hank: gobal varible fail

        // This function is defined below and deals with the JSON data parsed from the file. 
        displayJSON(parsedObj); 

    }
};

xmlhttp.open("GET", url, true);
xmlhttp.send();


function readDate(obj,dir_date_l)
{
    for(var i =0; i< obj.length; i++)
    {
        dir_date_l[obj[i].date] = obj[i].day;
    }
    return 0;
}


function readTime(obj,date,dir_date_time)
{
    if(date in dir_date_time)
    {
        return 0
    }
    else
    {
        for(var i =0; i< obj.length; i++)
        {
            if(obj[i].date == date)
            {   
                var ls_time=[];
                var keys = Object.keys(obj[i].slots); //slot id
                for(var j=0;j<keys.length; j++)
                {
                    ls_time.push(obj[i].slots[keys[j]].time);
                    dir_date_time[date] = ls_time;
                }
                return 0;
            }
        }
        return -1;
    }
}
    
function displayJSON(obj) {
    console.log('in display JSON');
    var text = '';
    var text_2 = [];

    try 
    {
        if(! readDate(obj,dir_date))
        {
            console.log(dir_date);
            var keys = Object.keys(dir_date);
            text = "<select>";
            for(var i =0; i < keys.length; i++) 
            {
                text +="<option>"+keys[i]+" ,"+dir_date[keys[i]]+"</option>";
                console.log(text);
            }  
            text += "</select>";
            

            // try
            // {
            //     var keys = Object.keys(dir_date);
            //     readTime(parsedObj,keys[1],dir_date_time)
            //     console.log(dir_date_time)
            // }
            // catch
            // {
            //     text += "Fail to read time"
            // }
        }
    }
    catch
    {
        text += "Fail to read date"
    }
    // Add the new html code to the div element with id = 'id01'.
    document.getElementById("id01").innerHTML = text;
    // document.getElementById("id02").innerHTML = text_2;
}


// displayJSON_test(parsedObj); 


</script>

</body>
</html>